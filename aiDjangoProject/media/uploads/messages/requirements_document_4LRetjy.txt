需求文档：基于8051单片机的太阳能自动跟踪系统
1. 项目概述
本系统基于8051系列单片机（如AT89C51）设计，通过光敏电阻传感器检测环境光照强度，实现太阳能板的自动跟踪控制。系统支持手动与自动双模式运行，能够根据光源方向调整太阳能板的水平和垂直角度，最大化光能吸收效率。核心功能包括传感器数据采集、步进电机驱动、异常状态指示及人机交互控制，适用于太阳能发电设备的光源追踪场景。

2. 功能需求
功能编号	功能描述	输入/触发条件	输出/响应结果
F1	手动/自动模式切换	按下模式切换按键（P3.5）	切换LED指示灯（P1.2/P1.3）状态
F2	手动方向控制	按下方向按键（上下左右）	步进电机按指定方向转动
F3	自动光源跟踪	自动模式下光敏电阻输入	步进电机自动调整至光源最强方向
F4	传感器异常检测	光敏电阻值超限（0或255）	LED双灯闪烁提示错误
F5	步进电机驱动控制	方向标志位触发	步进电机按预设相位序列转动
F6	系统状态显示	实时运行中	LED指示当前模式（手动/自动/异常）
3. 非功能需求
性能指标

跟踪精度：光强差值容错范围±15（可配置），差值小于4（垂直）/7（水平）时停止微调。

响应速度：步进电机驱动周期2.5ms，确保转动平滑无抖动。

传感器采样率：ADC数据每秒更新≥100次。

异常恢复：传感器恢复正常后，系统自动退出错误状态。

硬件约束

主控芯片：AT89C51单片机，12MHz晶振。

传感器模块：4路光敏电阻（连接PCF8591 ADC芯片），检测范围0-5V。

执行机构：2路四相步进电机，分别控制水平和垂直方向。

人机接口：5个独立按键（模式切换、上下左右控制），2个LED状态指示灯。

可靠性要求

工作温度范围：-20℃~70℃。

持续运行时间：≥24×7小时。

抗干扰设计：光敏电阻输入信号需经RC滤波，按键硬件去抖。

4. 系统设计
4.1 硬件设计
模块	配置说明
主控电路	AT89C51最小系统（含复位电路、12MHz晶振）
ADC模块	PCF8591芯片，I2C接口（SDA→P1.0, SCL→P1.1）
步进电机驱动	水平方向电机接P2.0-P2.3，垂直方向接P2.4-P2.7
传感器输入	4路光敏电阻连接PCF8591通道0-3（AD0-AD3）
状态指示	手动模式LED（P1.2），自动模式LED（P1.3）
4.2 软件设计
主程序流程

plaintext
复制
初始化 → 配置定时器、ADC → 进入主循环:  
  1. 读取光敏电阻值（AD0-AD3）  
  2. 检测按键输入，切换模式或方向  
  3. 执行自动跟踪逻辑（差值计算与方向决策）  
  4. 更新步进电机控制信号  
  5. 检测传感器异常并触发告警  
关键逻辑

自动跟踪算法：

垂直方向：比较上下光敏电阻值（AD0 vs AD1），差值≥15时调整电机方向。

水平方向：比较左右光敏电阻值（AD2 vs AD3），差值≥15时调整电机方向。

步进电机控制：

使用8相位驱动序列（如0x01, 0x03, 0x02…），通过定时器中断（2.5ms）循环输出。

异常处理：

光敏电阻值超出0-255范围时，双LED以1Hz频率闪烁告警。

5. 测试验证
测试项	预期结果	通过标准
手动模式控制	按键按下后步进电机按预期方向转动	电机转动方向与按键定义一致
自动模式光源跟踪	光源偏移后电机自动调整至对准位置	调整时间≤2秒，停止后光强差值<4
传感器异常检测	光敏电阻短路/开路	双LED闪烁，电机停止运行
模式切换响应	按下模式键后LED状态切换	手动/自动模式指示正确
步进电机驱动稳定性	连续运行1小时	无丢步、过热现象
6. 依赖项
硬件依赖

PCF8591 ADC模块、四相步进电机、光敏电阻阵列、5V稳压电源。

软件依赖

Keil C51开发环境，支持8051指令集及定时器中断配置。


附录
光敏电阻布局

传感器	功能	PCF8591通道
AD0	下方光强检测	通道0
AD1	上方光强检测	通道1
AD2	右方光强检测	通道2
AD3	左方光强检测	通道3
步进电机相位表

方向	控制码序列（16进制）
垂直正转	0x01, 0x03, 0x02, 0x06, 0x04, 0x0C, 0x08, 0x09
垂直反转	0x09, 0x08, 0x0C, 0x04, 0x06, 0x02, 0x03, 0x01
水平正转	0x10, 0x30, 0x20, 0x60, 0x40, 0xC0, 0x80, 0x90
水平反转	0x90, 0x80, 0xC0, 0x40, 0x60, 0x20, 0x30, 0x10
